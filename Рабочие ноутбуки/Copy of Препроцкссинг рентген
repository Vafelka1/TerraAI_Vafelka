{"cells":[{"cell_type":"markdown","source":[],"metadata":{"id":"h3OEaxiSxDBQ"}},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":22983,"status":"ok","timestamp":1693062398787,"user":{"displayName":"Vafelka","userId":"11276804272897708630"},"user_tz":-180},"id":"VcRFAyse4rdF","outputId":"61b80304-bf36-43ae-dc63-78274fd74ffb"},"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /content/drive\n","Drive already mounted at /content/drive; to attempt to forcibly remount, call drive.mount(\"/content/drive\", force_remount=True).\n"]}],"source":["from google.colab import drive\n","drive.mount('/content/drive')"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"4xJVNgXeCHqC"},"outputs":[],"source":["#!rm -f -r ph_final"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"S1j6YwOWDMoC"},"outputs":[],"source":["!unzip -q '/content/drive/MyDrive/Стажировка/Рентген/ph_final.zip' -d '/content'"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"SrfY9rdQC1bK"},"outputs":[],"source":["from PIL import Image\n","import matplotlib.pyplot as plt\n","import cv2\n","import pandas as pd\n","import numpy as np\n","import os"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"yDP4pJzAXm2y"},"outputs":[],"source":["arr = np.zeros((0,8), dtype=int)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"1im7LYOAXD9D"},"outputs":[],"source":["columns = ('image_name', 'page_width', 'page_height', 'x', 'y', 'width', 'height', 'labels')\n","df = pd.DataFrame(arr,columns=columns)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":89},"executionInfo":{"elapsed":5,"status":"ok","timestamp":1692476912797,"user":{"displayName":"Vafelka","userId":"11276804272897708630"},"user_tz":-180},"id":"cwAIkP_1-71H","outputId":"e0cc5fe3-6c94-4d04-f376-71484df0ad74"},"outputs":[{"data":{"text/html":["\n","  <div id=\"df-b5a319b9-2054-4254-80db-eb88804174e3\" class=\"colab-df-container\">\n","    <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>image_name</th>\n","      <th>page_width</th>\n","      <th>page_height</th>\n","      <th>x</th>\n","      <th>y</th>\n","      <th>width</th>\n","      <th>height</th>\n","      <th>labels</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","  </tbody>\n","</table>\n","</div>\n","    <div class=\"colab-df-buttons\">\n","\n","  <div class=\"colab-df-container\">\n","    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-b5a319b9-2054-4254-80db-eb88804174e3')\"\n","            title=\"Convert this dataframe to an interactive table.\"\n","            style=\"display:none;\">\n","\n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n","    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n","  </svg>\n","    </button>\n","\n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    .colab-df-buttons div {\n","      margin-bottom: 4px;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","    <script>\n","      const buttonEl =\n","        document.querySelector('#df-b5a319b9-2054-4254-80db-eb88804174e3 button.colab-df-convert');\n","      buttonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","      async function convertToInteractive(key) {\n","        const element = document.querySelector('#df-b5a319b9-2054-4254-80db-eb88804174e3');\n","        const dataTable =\n","          await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                    [key], {});\n","        if (!dataTable) return;\n","\n","        const docLinkHtml = 'Like what you see? Visit the ' +\n","          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","          + ' to learn more about interactive tables.';\n","        element.innerHTML = '';\n","        dataTable['output_type'] = 'display_data';\n","        await google.colab.output.renderOutput(dataTable, element);\n","        const docLink = document.createElement('div');\n","        docLink.innerHTML = docLinkHtml;\n","        element.appendChild(docLink);\n","      }\n","    </script>\n","  </div>\n","\n","\n","<div id=\"df-e2ca32f7-94bd-4fdd-b1ff-f4439f8e1009\">\n","  <button class=\"colab-df-quickchart\" onclick=\"quickchart('df-e2ca32f7-94bd-4fdd-b1ff-f4439f8e1009')\"\n","            title=\"Suggest charts.\"\n","            style=\"display:none;\">\n","\n","<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","     width=\"24px\">\n","    <g>\n","        <path d=\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z\"/>\n","    </g>\n","</svg>\n","  </button>\n","\n","<style>\n","  .colab-df-quickchart {\n","    background-color: #E8F0FE;\n","    border: none;\n","    border-radius: 50%;\n","    cursor: pointer;\n","    display: none;\n","    fill: #1967D2;\n","    height: 32px;\n","    padding: 0 0 0 0;\n","    width: 32px;\n","  }\n","\n","  .colab-df-quickchart:hover {\n","    background-color: #E2EBFA;\n","    box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","    fill: #174EA6;\n","  }\n","\n","  [theme=dark] .colab-df-quickchart {\n","    background-color: #3B4455;\n","    fill: #D2E3FC;\n","  }\n","\n","  [theme=dark] .colab-df-quickchart:hover {\n","    background-color: #434B5C;\n","    box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","    filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","    fill: #FFFFFF;\n","  }\n","</style>\n","\n","  <script>\n","    async function quickchart(key) {\n","      const charts = await google.colab.kernel.invokeFunction(\n","          'suggestCharts', [key], {});\n","    }\n","    (() => {\n","      let quickchartButtonEl =\n","        document.querySelector('#df-e2ca32f7-94bd-4fdd-b1ff-f4439f8e1009 button');\n","      quickchartButtonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","    })();\n","  </script>\n","</div>\n","    </div>\n","  </div>\n"],"text/plain":["Empty DataFrame\n","Columns: [image_name, page_width, page_height, x, y, width, height, labels]\n","Index: []"]},"execution_count":6,"metadata":{},"output_type":"execute_result"}],"source":["df"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"eXJfq7MRfVTw"},"outputs":[],"source":["def xyxy_to_xywh(xyxy):\n","    \"\"\"\n","    Convert XYXY format (x,y top left and x,y bottom right) to XYWH format (x,y center point and width, height).\n","    :param xyxy: [X1, Y1, X2, Y2]\n","    :return: [X, Y, W, H]\n","    \"\"\"\n","    if np.array(xyxy).ndim > 1 or len(xyxy) > 4:\n","        raise ValueError('xyxy format: [x1, y1, x2, y2]')\n","    x_temp = (xyxy[0] + xyxy[2]) / 2\n","    y_temp = (xyxy[1] + xyxy[3]) / 2\n","    w_temp = abs(xyxy[0] - xyxy[2])\n","    h_temp = abs(xyxy[1] - xyxy[3])\n","    return np.array([int(x_temp), int(y_temp), int(w_temp), int(h_temp)])"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":11536,"status":"ok","timestamp":1692476924329,"user":{"displayName":"Vafelka","userId":"11276804272897708630"},"user_tz":-180},"id":"6JTTZUmny4nW","outputId":"5153caca-c1c8-4014-eaeb-ca66b37da4fb"},"outputs":[{"name":"stdout","output_type":"stream","text":["Collecting pybboxes\n","  Downloading pybboxes-0.1.6-py3-none-any.whl (24 kB)\n","Requirement already satisfied: numpy in /usr/local/lib/python3.10/dist-packages (from pybboxes) (1.23.5)\n","Installing collected packages: pybboxes\n","Successfully installed pybboxes-0.1.6\n"]}],"source":["!pip install pybboxes\n","import pybboxes as pbx\n","def yolo_to_voc(yolo_box,W=424,H=1280):\n","\n","    yolo_bbox = yolo_box\n","    W, H = W,H  # WxH of the image\n","    xmin, ymin, xmax, ymax = pbx.convert_bbox(yolo_bbox, from_type=\"yolo\", to_type=\"voc\", image_size=(W,H))\n","\n","    return (xmin, ymin, xmax, ymax)\n","\n","def voc_to_yolo(voc_box,W=424,H=1280):\n","\n","    yolo_bbox = voc_box\n","    W, H = W,H  # WxH of the image\n","    xmin, ymin, xmax, ymax = pbx.convert_bbox(voc_box, from_type=\"voc\", to_type=\"yolo\", image_size=(W,H))\n","\n","    return (xmin, ymin, xmax, ymax)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"w8TDPGaZYBR6"},"outputs":[],"source":["from __future__ import with_statement\n","train_im='/content/ph_final/train/images'\n","train_lab='/content/ph_final/train/labels'\n","name_i_list = os.listdir(train_im)\n","name_l_list = os.listdir(train_lab)\n","\n","\n","#for i in range(6):\n","for i in range(len(name_l_list)):\n","  image = f'{train_im}/{name_i_list[i]}'\n","  label = f'{train_lab}/{name_l_list[i]}'\n","\n","  img_name = str(image.split('/')[-1])\n","  img = Image.open(image)\n","  old_W,old_H = img.size\n","\n","\n","  new_label = 0\n","\n","  with open(label,'r') as f:\n","    text = f.readlines()\n","\n","    if len(text) == 0:\n","      continue\n","\n","\n","    for j in range(len(text)):\n","      new_str=text[j]\n","\n","      x = float(new_str[1:].split(' ')[1])\n","      y = float(new_str[1:].split(' ')[2])\n","      w = float(new_str[1:].split(' ')[3])\n","      h = float(new_str[1:].split(' ')[4])\n","\n","      yolo_box = (x,y,w,h)\n","      coord = yolo_to_voc(yolo_box,W=old_W,H=old_H)\n","\n","      ##\n","      new_coord = xyxy_to_xywh(coord)\n","\n","      x,y,w,h=new_coord\n","\n","      sr = pd.Series(data = {'image_name':img_name,'page_width':old_W,'page_height':old_H,'x':x,'y':y,'width':w,'height':h,'labels':new_label})\n","      df = df.append(sr.to_frame().T)\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":423},"executionInfo":{"elapsed":222,"status":"ok","timestamp":1692477346003,"user":{"displayName":"Vafelka","userId":"11276804272897708630"},"user_tz":-180},"id":"71PIUM7KIMx8","outputId":"a8efaf2e-71d3-4b10-f3fd-b4163b445f2a"},"outputs":[{"data":{"text/html":["\n","  <div id=\"df-1863f720-b11b-4a16-953e-3e538e5703c8\" class=\"colab-df-container\">\n","    <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>image_name</th>\n","      <th>page_width</th>\n","      <th>page_height</th>\n","      <th>x</th>\n","      <th>y</th>\n","      <th>width</th>\n","      <th>height</th>\n","      <th>labels</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>42_7_png.rf.2f422e73be91168289241006c54ed513.jpg</td>\n","      <td>985</td>\n","      <td>2048</td>\n","      <td>572</td>\n","      <td>584</td>\n","      <td>88</td>\n","      <td>126</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>0</th>\n","      <td>42_7_png.rf.2f422e73be91168289241006c54ed513.jpg</td>\n","      <td>985</td>\n","      <td>2048</td>\n","      <td>536</td>\n","      <td>1238</td>\n","      <td>96</td>\n","      <td>114</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>0</th>\n","      <td>42_7_png.rf.2f422e73be91168289241006c54ed513.jpg</td>\n","      <td>985</td>\n","      <td>2048</td>\n","      <td>796</td>\n","      <td>1216</td>\n","      <td>66</td>\n","      <td>161</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>0</th>\n","      <td>42_7_png.rf.2f422e73be91168289241006c54ed513.jpg</td>\n","      <td>985</td>\n","      <td>2048</td>\n","      <td>44</td>\n","      <td>1167</td>\n","      <td>87</td>\n","      <td>53</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>0</th>\n","      <td>42_7_png.rf.2f422e73be91168289241006c54ed513.jpg</td>\n","      <td>985</td>\n","      <td>2048</td>\n","      <td>16</td>\n","      <td>1251</td>\n","      <td>29</td>\n","      <td>36</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>0</th>\n","      <td>232_processed.jpg</td>\n","      <td>576</td>\n","      <td>1560</td>\n","      <td>312</td>\n","      <td>1206</td>\n","      <td>56</td>\n","      <td>105</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>0</th>\n","      <td>232_processed.jpg</td>\n","      <td>576</td>\n","      <td>1560</td>\n","      <td>366</td>\n","      <td>993</td>\n","      <td>51</td>\n","      <td>113</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>0</th>\n","      <td>232_processed.jpg</td>\n","      <td>576</td>\n","      <td>1560</td>\n","      <td>227</td>\n","      <td>486</td>\n","      <td>33</td>\n","      <td>81</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>0</th>\n","      <td>232_processed.jpg</td>\n","      <td>576</td>\n","      <td>1560</td>\n","      <td>187</td>\n","      <td>840</td>\n","      <td>63</td>\n","      <td>41</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>0</th>\n","      <td>232_processed.jpg</td>\n","      <td>576</td>\n","      <td>1560</td>\n","      <td>188</td>\n","      <td>932</td>\n","      <td>27</td>\n","      <td>21</td>\n","      <td>0</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>8288 rows × 8 columns</p>\n","</div>\n","    <div class=\"colab-df-buttons\">\n","\n","  <div class=\"colab-df-container\">\n","    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-1863f720-b11b-4a16-953e-3e538e5703c8')\"\n","            title=\"Convert this dataframe to an interactive table.\"\n","            style=\"display:none;\">\n","\n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n","    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n","  </svg>\n","    </button>\n","\n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    .colab-df-buttons div {\n","      margin-bottom: 4px;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","    <script>\n","      const buttonEl =\n","        document.querySelector('#df-1863f720-b11b-4a16-953e-3e538e5703c8 button.colab-df-convert');\n","      buttonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","      async function convertToInteractive(key) {\n","        const element = document.querySelector('#df-1863f720-b11b-4a16-953e-3e538e5703c8');\n","        const dataTable =\n","          await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                    [key], {});\n","        if (!dataTable) return;\n","\n","        const docLinkHtml = 'Like what you see? Visit the ' +\n","          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","          + ' to learn more about interactive tables.';\n","        element.innerHTML = '';\n","        dataTable['output_type'] = 'display_data';\n","        await google.colab.output.renderOutput(dataTable, element);\n","        const docLink = document.createElement('div');\n","        docLink.innerHTML = docLinkHtml;\n","        element.appendChild(docLink);\n","      }\n","    </script>\n","  </div>\n","\n","\n","<div id=\"df-983222c7-2353-4cd5-a76a-a11766cb8d9e\">\n","  <button class=\"colab-df-quickchart\" onclick=\"quickchart('df-983222c7-2353-4cd5-a76a-a11766cb8d9e')\"\n","            title=\"Suggest charts.\"\n","            style=\"display:none;\">\n","\n","<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","     width=\"24px\">\n","    <g>\n","        <path d=\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z\"/>\n","    </g>\n","</svg>\n","  </button>\n","\n","<style>\n","  .colab-df-quickchart {\n","    background-color: #E8F0FE;\n","    border: none;\n","    border-radius: 50%;\n","    cursor: pointer;\n","    display: none;\n","    fill: #1967D2;\n","    height: 32px;\n","    padding: 0 0 0 0;\n","    width: 32px;\n","  }\n","\n","  .colab-df-quickchart:hover {\n","    background-color: #E2EBFA;\n","    box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","    fill: #174EA6;\n","  }\n","\n","  [theme=dark] .colab-df-quickchart {\n","    background-color: #3B4455;\n","    fill: #D2E3FC;\n","  }\n","\n","  [theme=dark] .colab-df-quickchart:hover {\n","    background-color: #434B5C;\n","    box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","    filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","    fill: #FFFFFF;\n","  }\n","</style>\n","\n","  <script>\n","    async function quickchart(key) {\n","      const charts = await google.colab.kernel.invokeFunction(\n","          'suggestCharts', [key], {});\n","    }\n","    (() => {\n","      let quickchartButtonEl =\n","        document.querySelector('#df-983222c7-2353-4cd5-a76a-a11766cb8d9e button');\n","      quickchartButtonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","    })();\n","  </script>\n","</div>\n","    </div>\n","  </div>\n"],"text/plain":["                                          image_name page_width page_height  \\\n","0   42_7_png.rf.2f422e73be91168289241006c54ed513.jpg        985        2048   \n","0   42_7_png.rf.2f422e73be91168289241006c54ed513.jpg        985        2048   \n","0   42_7_png.rf.2f422e73be91168289241006c54ed513.jpg        985        2048   \n","0   42_7_png.rf.2f422e73be91168289241006c54ed513.jpg        985        2048   \n","0   42_7_png.rf.2f422e73be91168289241006c54ed513.jpg        985        2048   \n","..                                               ...        ...         ...   \n","0                                  232_processed.jpg        576        1560   \n","0                                  232_processed.jpg        576        1560   \n","0                                  232_processed.jpg        576        1560   \n","0                                  232_processed.jpg        576        1560   \n","0                                  232_processed.jpg        576        1560   \n","\n","      x     y width height labels  \n","0   572   584    88    126      0  \n","0   536  1238    96    114      0  \n","0   796  1216    66    161      0  \n","0    44  1167    87     53      0  \n","0    16  1251    29     36      0  \n","..  ...   ...   ...    ...    ...  \n","0   312  1206    56    105      0  \n","0   366   993    51    113      0  \n","0   227   486    33     81      0  \n","0   187   840    63     41      0  \n","0   188   932    27     21      0  \n","\n","[8288 rows x 8 columns]"]},"execution_count":28,"metadata":{},"output_type":"execute_result"}],"source":["df"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"6nCSCnvtIxOW"},"outputs":[],"source":["df.to_csv('/content/drive/MyDrive/Стажировка/Рентген/transformer_labels.csv', index=False)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":581,"status":"ok","timestamp":1692477466312,"user":{"displayName":"Vafelka","userId":"11276804272897708630"},"user_tz":-180},"id":"rwCLr9kLLZK_","outputId":"81cb48d0-c236-4884-be4a-d4fcddcbc955"},"outputs":[{"name":"stdout","output_type":"stream","text":["[85, 925, 36, 142]\n"]}],"source":["import matplotlib.pyplot as plt\n","import matplotlib.patches as patches\n","from PIL import Image\n","import random\n","\n","new_df = df.reset_index()\n","\n","from PIL import ImageDraw\n","\n","i = random.randint(0, df.shape[0])\n","im_name = new_df.loc[i,'image_name']\n","im_name = f'/content/ph_final/train/images/{im_name}'\n","x=new_df.loc[i,'x']\n","y=new_df.loc[i,'y']\n","w=new_df.loc[i,'width']\n","h=new_df.loc[i,'height']\n","H=new_df.loc[i,'page_height']\n","\n","\n","yy=[x,y,w,h]\n","\n","print(yy)\n","\n","im = Image.open(im_name)\n","draw = ImageDraw.Draw(im)\n","draw.rectangle(yy,outline=(225,0,0), width=2)\n","im.show()\n","im.save('1.png')\n","\n","\n","# Create figure and axes\n","#fig, ax = plt.subplots()\n","\n","# Display the image\n","#ax.imshow(im)\n","\n","# Create a Rectangle patch\n","#rect = patches.Rectangle((xmin, aY), w, h, linewidth=1, edgecolor='r', facecolor='none')\n","\n","# Add the patch to the Axes\n","#ax.add_patch(rect)\n","\n","#plt.show()"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":197,"status":"ok","timestamp":1692477477225,"user":{"displayName":"Vafelka","userId":"11276804272897708630"},"user_tz":-180},"id":"HC6FZ6iW8Zxi","outputId":"9cb16085-7387-4eb5-e9a2-f42924146184"},"outputs":[{"data":{"text/plain":["index                                                         0\n","image_name     65_2_png.rf.0490055c20e3c281d197d326d421ecfa.jpg\n","page_width                                                  841\n","page_height                                                2048\n","x                                                            85\n","y                                                           925\n","width                                                        36\n","height                                                      142\n","labels                                                        0\n","Name: 1697, dtype: object"]},"execution_count":33,"metadata":{},"output_type":"execute_result"}],"source":["new_df.loc[i]"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"ruu9pq3cgc38"},"outputs":[],"source":[]},{"cell_type":"code","execution_count":null,"metadata":{"id":"NVUXR_PrihD1"},"outputs":[],"source":[]},{"cell_type":"code","execution_count":null,"metadata":{"id":"9Ap_i2nsihGd"},"outputs":[],"source":["!rm -f -r plant_detector"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":1191,"status":"ok","timestamp":1693062422945,"user":{"displayName":"Vafelka","userId":"11276804272897708630"},"user_tz":-180},"id":"TKAu842vgc6O","outputId":"9aa78b21-f451-45fd-c2ab-896dcf182834"},"outputs":[{"output_type":"stream","name":"stdout","text":["Cloning into 'Transform_detector'...\n","remote: Enumerating objects: 47, done.\u001b[K\n","remote: Counting objects: 100% (47/47), done.\u001b[K\n","remote: Compressing objects: 100% (43/43), done.\u001b[K\n","remote: Total 47 (delta 11), reused 32 (delta 2), pack-reused 0\u001b[K\n","Receiving objects: 100% (47/47), 5.30 MiB | 32.27 MiB/s, done.\n","Resolving deltas: 100% (11/11), done.\n"]}],"source":["!git clone -b Vafelka1-new_train https://github.com/Vafelka1/Transform_detector"]},{"cell_type":"code","source":["import json\n","with open('Transform_detector/config.json') as f:\n","    data = json.load(f)\n","data['max_steps'] = 8000\n","with open('Transform_detector/config.json', 'w') as f:\n","    json.dump(data, f, ensure_ascii=False, indent=4)"],"metadata":{"id":"jnJf9tWY8kP5"},"execution_count":null,"outputs":[]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":1000},"executionInfo":{"elapsed":53573,"status":"ok","timestamp":1693062765867,"user":{"displayName":"Vafelka","userId":"11276804272897708630"},"user_tz":-180},"id":"nRSOqBncih3W","outputId":"0057da3f-902a-4ff6-c157-6e74935345e2"},"outputs":[{"output_type":"stream","name":"stdout","text":["Collecting pytorch_lightning==1.6.5 (from -r /content/Transform_detector/requirements.txt (line 1))\n","  Downloading pytorch_lightning-1.6.5-py3-none-any.whl (585 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m585.9/585.9 kB\u001b[0m \u001b[31m6.8 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hCollecting transformers==4.20.1 (from -r /content/Transform_detector/requirements.txt (line 2))\n","  Downloading transformers-4.20.1-py3-none-any.whl (4.4 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m4.4/4.4 MB\u001b[0m \u001b[31m20.8 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hCollecting matplotlib==3.5.2 (from -r /content/Transform_detector/requirements.txt (line 3))\n","  Downloading matplotlib-3.5.2-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (11.9 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m11.9/11.9 MB\u001b[0m \u001b[31m57.0 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hRequirement already satisfied: torch==1.12.0 in /usr/local/lib/python3.10/dist-packages (from -r /content/Transform_detector/requirements.txt (line 4)) (1.12.0)\n","Collecting torchaudio==0.12.0 (from -r /content/Transform_detector/requirements.txt (line 5))\n","  Downloading torchaudio-0.12.0-cp310-cp310-manylinux1_x86_64.whl (3.7 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m3.7/3.7 MB\u001b[0m \u001b[31m34.4 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hCollecting torchvision==0.13.0 (from -r /content/Transform_detector/requirements.txt (line 6))\n","  Downloading torchvision-0.13.0-cp310-cp310-manylinux1_x86_64.whl (19.1 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m19.1/19.1 MB\u001b[0m \u001b[31m84.9 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hCollecting pandas==1.4.3 (from -r /content/Transform_detector/requirements.txt (line 7))\n","  Downloading pandas-1.4.3-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (11.6 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m11.6/11.6 MB\u001b[0m \u001b[31m109.5 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hCollecting timm==0.6.5 (from -r /content/Transform_detector/requirements.txt (line 8))\n","  Downloading timm-0.6.5-py3-none-any.whl (512 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m512.8/512.8 kB\u001b[0m \u001b[31m54.0 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hCollecting tqdm==4.64.0 (from -r /content/Transform_detector/requirements.txt (line 9))\n","  Downloading tqdm-4.64.0-py2.py3-none-any.whl (78 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m78.4/78.4 kB\u001b[0m \u001b[31m9.2 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hCollecting pycocotools==2.0.2 (from -r /content/Transform_detector/requirements.txt (line 10))\n","  Downloading pycocotools-2.0.2.tar.gz (23 kB)\n","  Preparing metadata (setup.py) ... \u001b[?25l\u001b[?25hdone\n","Collecting scipy==1.8.1 (from -r /content/Transform_detector/requirements.txt (line 11))\n","  Downloading scipy-1.8.1-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (42.2 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m42.2/42.2 MB\u001b[0m \u001b[31m12.3 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hRequirement already satisfied: numpy>=1.17.2 in /usr/local/lib/python3.10/dist-packages (from pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1)) (1.23.5)\n","Requirement already satisfied: PyYAML>=5.4 in /usr/local/lib/python3.10/dist-packages (from pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1)) (6.0.1)\n","Requirement already satisfied: fsspec[http]!=2021.06.0,>=2021.05.0 in /usr/local/lib/python3.10/dist-packages (from pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1)) (2023.6.0)\n","Requirement already satisfied: tensorboard>=2.2.0 in /usr/local/lib/python3.10/dist-packages (from pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1)) (2.12.3)\n","Collecting torchmetrics>=0.4.1 (from pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1))\n","  Downloading torchmetrics-1.1.0-py3-none-any.whl (761 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m761.3/761.3 kB\u001b[0m \u001b[31m55.5 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hCollecting pyDeprecate>=0.3.1 (from pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1))\n","  Downloading pyDeprecate-0.3.2-py3-none-any.whl (10 kB)\n","Requirement already satisfied: packaging>=17.0 in /usr/local/lib/python3.10/dist-packages (from pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1)) (23.1)\n","Requirement already satisfied: typing-extensions>=4.0.0 in /usr/local/lib/python3.10/dist-packages (from pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1)) (4.7.1)\n","Collecting protobuf<=3.20.1 (from pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1))\n","  Downloading protobuf-3.20.1-cp310-cp310-manylinux_2_12_x86_64.manylinux2010_x86_64.whl (1.1 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m1.1/1.1 MB\u001b[0m \u001b[31m70.0 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hRequirement already satisfied: filelock in /usr/local/lib/python3.10/dist-packages (from transformers==4.20.1->-r /content/Transform_detector/requirements.txt (line 2)) (3.12.2)\n","Collecting huggingface-hub<1.0,>=0.1.0 (from transformers==4.20.1->-r /content/Transform_detector/requirements.txt (line 2))\n","  Downloading huggingface_hub-0.16.4-py3-none-any.whl (268 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m268.8/268.8 kB\u001b[0m \u001b[31m29.3 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hRequirement already satisfied: regex!=2019.12.17 in /usr/local/lib/python3.10/dist-packages (from transformers==4.20.1->-r /content/Transform_detector/requirements.txt (line 2)) (2023.6.3)\n","Requirement already satisfied: requests in /usr/local/lib/python3.10/dist-packages (from transformers==4.20.1->-r /content/Transform_detector/requirements.txt (line 2)) (2.31.0)\n","Collecting tokenizers!=0.11.3,<0.13,>=0.11.1 (from transformers==4.20.1->-r /content/Transform_detector/requirements.txt (line 2))\n","  Downloading tokenizers-0.12.1-cp310-cp310-manylinux_2_12_x86_64.manylinux2010_x86_64.whl (6.6 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m6.6/6.6 MB\u001b[0m \u001b[31m104.6 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hRequirement already satisfied: cycler>=0.10 in /usr/local/lib/python3.10/dist-packages (from matplotlib==3.5.2->-r /content/Transform_detector/requirements.txt (line 3)) (0.11.0)\n","Requirement already satisfied: fonttools>=4.22.0 in /usr/local/lib/python3.10/dist-packages (from matplotlib==3.5.2->-r /content/Transform_detector/requirements.txt (line 3)) (4.42.1)\n","Requirement already satisfied: kiwisolver>=1.0.1 in /usr/local/lib/python3.10/dist-packages (from matplotlib==3.5.2->-r /content/Transform_detector/requirements.txt (line 3)) (1.4.4)\n","Requirement already satisfied: pillow>=6.2.0 in /usr/local/lib/python3.10/dist-packages (from matplotlib==3.5.2->-r /content/Transform_detector/requirements.txt (line 3)) (9.4.0)\n","Requirement already satisfied: pyparsing>=2.2.1 in /usr/local/lib/python3.10/dist-packages (from matplotlib==3.5.2->-r /content/Transform_detector/requirements.txt (line 3)) (3.1.1)\n","Requirement already satisfied: python-dateutil>=2.7 in /usr/local/lib/python3.10/dist-packages (from matplotlib==3.5.2->-r /content/Transform_detector/requirements.txt (line 3)) (2.8.2)\n","Requirement already satisfied: pytz>=2020.1 in /usr/local/lib/python3.10/dist-packages (from pandas==1.4.3->-r /content/Transform_detector/requirements.txt (line 7)) (2023.3)\n","Requirement already satisfied: setuptools>=18.0 in /usr/local/lib/python3.10/dist-packages (from pycocotools==2.0.2->-r /content/Transform_detector/requirements.txt (line 10)) (67.7.2)\n","Requirement already satisfied: cython>=0.27.3 in /usr/local/lib/python3.10/dist-packages (from pycocotools==2.0.2->-r /content/Transform_detector/requirements.txt (line 10)) (0.29.36)\n","Requirement already satisfied: aiohttp!=4.0.0a0,!=4.0.0a1 in /usr/local/lib/python3.10/dist-packages (from fsspec[http]!=2021.06.0,>=2021.05.0->pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1)) (3.8.5)\n","Requirement already satisfied: six>=1.5 in /usr/local/lib/python3.10/dist-packages (from python-dateutil>=2.7->matplotlib==3.5.2->-r /content/Transform_detector/requirements.txt (line 3)) (1.16.0)\n","Requirement already satisfied: absl-py>=0.4 in /usr/local/lib/python3.10/dist-packages (from tensorboard>=2.2.0->pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1)) (1.4.0)\n","Requirement already satisfied: grpcio>=1.48.2 in /usr/local/lib/python3.10/dist-packages (from tensorboard>=2.2.0->pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1)) (1.57.0)\n","Requirement already satisfied: google-auth<3,>=1.6.3 in /usr/local/lib/python3.10/dist-packages (from tensorboard>=2.2.0->pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1)) (2.17.3)\n","Requirement already satisfied: google-auth-oauthlib<1.1,>=0.5 in /usr/local/lib/python3.10/dist-packages (from tensorboard>=2.2.0->pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1)) (1.0.0)\n","Requirement already satisfied: markdown>=2.6.8 in /usr/local/lib/python3.10/dist-packages (from tensorboard>=2.2.0->pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1)) (3.4.4)\n","Requirement already satisfied: tensorboard-data-server<0.8.0,>=0.7.0 in /usr/local/lib/python3.10/dist-packages (from tensorboard>=2.2.0->pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1)) (0.7.1)\n","Requirement already satisfied: werkzeug>=1.0.1 in /usr/local/lib/python3.10/dist-packages (from tensorboard>=2.2.0->pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1)) (2.3.7)\n","Requirement already satisfied: wheel>=0.26 in /usr/local/lib/python3.10/dist-packages (from tensorboard>=2.2.0->pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1)) (0.41.2)\n","Requirement already satisfied: charset-normalizer<4,>=2 in /usr/local/lib/python3.10/dist-packages (from requests->transformers==4.20.1->-r /content/Transform_detector/requirements.txt (line 2)) (3.2.0)\n","Requirement already satisfied: idna<4,>=2.5 in /usr/local/lib/python3.10/dist-packages (from requests->transformers==4.20.1->-r /content/Transform_detector/requirements.txt (line 2)) (3.4)\n","Requirement already satisfied: urllib3<3,>=1.21.1 in /usr/local/lib/python3.10/dist-packages (from requests->transformers==4.20.1->-r /content/Transform_detector/requirements.txt (line 2)) (2.0.4)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.10/dist-packages (from requests->transformers==4.20.1->-r /content/Transform_detector/requirements.txt (line 2)) (2023.7.22)\n","Collecting lightning-utilities>=0.8.0 (from torchmetrics>=0.4.1->pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1))\n","  Downloading lightning_utilities-0.9.0-py3-none-any.whl (23 kB)\n","Requirement already satisfied: attrs>=17.3.0 in /usr/local/lib/python3.10/dist-packages (from aiohttp!=4.0.0a0,!=4.0.0a1->fsspec[http]!=2021.06.0,>=2021.05.0->pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1)) (23.1.0)\n","Requirement already satisfied: multidict<7.0,>=4.5 in /usr/local/lib/python3.10/dist-packages (from aiohttp!=4.0.0a0,!=4.0.0a1->fsspec[http]!=2021.06.0,>=2021.05.0->pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1)) (6.0.4)\n","Requirement already satisfied: async-timeout<5.0,>=4.0.0a3 in /usr/local/lib/python3.10/dist-packages (from aiohttp!=4.0.0a0,!=4.0.0a1->fsspec[http]!=2021.06.0,>=2021.05.0->pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1)) (4.0.3)\n","Requirement already satisfied: yarl<2.0,>=1.0 in /usr/local/lib/python3.10/dist-packages (from aiohttp!=4.0.0a0,!=4.0.0a1->fsspec[http]!=2021.06.0,>=2021.05.0->pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1)) (1.9.2)\n","Requirement already satisfied: frozenlist>=1.1.1 in /usr/local/lib/python3.10/dist-packages (from aiohttp!=4.0.0a0,!=4.0.0a1->fsspec[http]!=2021.06.0,>=2021.05.0->pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1)) (1.4.0)\n","Requirement already satisfied: aiosignal>=1.1.2 in /usr/local/lib/python3.10/dist-packages (from aiohttp!=4.0.0a0,!=4.0.0a1->fsspec[http]!=2021.06.0,>=2021.05.0->pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1)) (1.3.1)\n","Requirement already satisfied: cachetools<6.0,>=2.0.0 in /usr/local/lib/python3.10/dist-packages (from google-auth<3,>=1.6.3->tensorboard>=2.2.0->pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1)) (5.3.1)\n","Requirement already satisfied: pyasn1-modules>=0.2.1 in /usr/local/lib/python3.10/dist-packages (from google-auth<3,>=1.6.3->tensorboard>=2.2.0->pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1)) (0.3.0)\n","Requirement already satisfied: rsa<5,>=3.1.4 in /usr/local/lib/python3.10/dist-packages (from google-auth<3,>=1.6.3->tensorboard>=2.2.0->pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1)) (4.9)\n","Requirement already satisfied: requests-oauthlib>=0.7.0 in /usr/local/lib/python3.10/dist-packages (from google-auth-oauthlib<1.1,>=0.5->tensorboard>=2.2.0->pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1)) (1.3.1)\n","Requirement already satisfied: MarkupSafe>=2.1.1 in /usr/local/lib/python3.10/dist-packages (from werkzeug>=1.0.1->tensorboard>=2.2.0->pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1)) (2.1.3)\n","Requirement already satisfied: pyasn1<0.6.0,>=0.4.6 in /usr/local/lib/python3.10/dist-packages (from pyasn1-modules>=0.2.1->google-auth<3,>=1.6.3->tensorboard>=2.2.0->pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1)) (0.5.0)\n","Requirement already satisfied: oauthlib>=3.0.0 in /usr/local/lib/python3.10/dist-packages (from requests-oauthlib>=0.7.0->google-auth-oauthlib<1.1,>=0.5->tensorboard>=2.2.0->pytorch_lightning==1.6.5->-r /content/Transform_detector/requirements.txt (line 1)) (3.2.2)\n","Building wheels for collected packages: pycocotools\n","  Building wheel for pycocotools (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Created wheel for pycocotools: filename=pycocotools-2.0.2-cp310-cp310-linux_x86_64.whl size=332177 sha256=86ab7a8aad1df3f53924967b1c463b1f027ce51b0127186c587733de260becdd\n","  Stored in directory: /root/.cache/pip/wheels/80/29/9d/aca4c35b3af6ee34e5866977c8fa43d7cbb34cf59f63993670\n","Successfully built pycocotools\n","Installing collected packages: tokenizers, tqdm, scipy, pyDeprecate, protobuf, lightning-utilities, torchvision, torchmetrics, torchaudio, pandas, matplotlib, huggingface-hub, transformers, timm, pycocotools, pytorch_lightning\n","  Attempting uninstall: tqdm\n","    Found existing installation: tqdm 4.66.1\n","    Uninstalling tqdm-4.66.1:\n","      Successfully uninstalled tqdm-4.66.1\n","  Attempting uninstall: scipy\n","    Found existing installation: scipy 1.10.1\n","    Uninstalling scipy-1.10.1:\n","      Successfully uninstalled scipy-1.10.1\n","  Attempting uninstall: protobuf\n","    Found existing installation: protobuf 3.20.3\n","    Uninstalling protobuf-3.20.3:\n","      Successfully uninstalled protobuf-3.20.3\n","  Attempting uninstall: torchvision\n","    Found existing installation: torchvision 0.15.2+cu118\n","    Uninstalling torchvision-0.15.2+cu118:\n","      Successfully uninstalled torchvision-0.15.2+cu118\n","  Attempting uninstall: torchaudio\n","    Found existing installation: torchaudio 2.0.2+cu118\n","    Uninstalling torchaudio-2.0.2+cu118:\n","      Successfully uninstalled torchaudio-2.0.2+cu118\n","  Attempting uninstall: pandas\n","    Found existing installation: pandas 1.5.3\n","    Uninstalling pandas-1.5.3:\n","      Successfully uninstalled pandas-1.5.3\n","  Attempting uninstall: matplotlib\n","    Found existing installation: matplotlib 3.7.1\n","    Uninstalling matplotlib-3.7.1:\n","      Successfully uninstalled matplotlib-3.7.1\n","  Attempting uninstall: pycocotools\n","    Found existing installation: pycocotools 2.0.7\n","    Uninstalling pycocotools-2.0.7:\n","      Successfully uninstalled pycocotools-2.0.7\n","\u001b[31mERROR: pip's dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.\n","google-api-core 2.11.1 requires protobuf!=3.20.0,!=3.20.1,!=4.21.0,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,<5.0.0.dev0,>=3.19.5, but you have protobuf 3.20.1 which is incompatible.\n","google-cloud-bigquery 3.10.0 requires protobuf!=3.20.0,!=3.20.1,!=4.21.0,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,<5.0.0dev,>=3.19.5, but you have protobuf 3.20.1 which is incompatible.\n","google-cloud-bigquery-connection 1.12.1 requires protobuf!=3.20.0,!=3.20.1,!=4.21.0,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,<5.0.0dev,>=3.19.5, but you have protobuf 3.20.1 which is incompatible.\n","google-cloud-bigquery-storage 2.22.0 requires protobuf!=3.20.0,!=3.20.1,!=4.21.0,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,<5.0.0dev,>=3.19.5, but you have protobuf 3.20.1 which is incompatible.\n","google-cloud-datastore 2.15.2 requires protobuf!=3.20.0,!=3.20.1,!=4.21.0,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,<5.0.0dev,>=3.19.5, but you have protobuf 3.20.1 which is incompatible.\n","google-cloud-firestore 2.11.1 requires protobuf!=3.20.0,!=3.20.1,!=4.21.0,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,<5.0.0dev,>=3.19.5, but you have protobuf 3.20.1 which is incompatible.\n","google-cloud-functions 1.13.2 requires protobuf!=3.20.0,!=3.20.1,!=4.21.0,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,<5.0.0dev,>=3.19.5, but you have protobuf 3.20.1 which is incompatible.\n","google-cloud-language 2.9.1 requires protobuf!=3.20.0,!=3.20.1,!=4.21.0,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,<5.0.0dev,>=3.19.5, but you have protobuf 3.20.1 which is incompatible.\n","google-cloud-translate 3.11.3 requires protobuf!=3.20.0,!=3.20.1,!=4.21.0,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,<5.0.0dev,>=3.19.5, but you have protobuf 3.20.1 which is incompatible.\n","google-colab 1.0.0 requires pandas==1.5.3, but you have pandas 1.4.3 which is incompatible.\n","googleapis-common-protos 1.60.0 requires protobuf!=3.20.0,!=3.20.1,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,<5.0.0.dev0,>=3.19.5, but you have protobuf 3.20.1 which is incompatible.\n","grpc-google-iam-v1 0.12.6 requires protobuf!=3.20.0,!=3.20.1,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,<5.0.0dev,>=3.19.5, but you have protobuf 3.20.1 which is incompatible.\n","plotnine 0.12.2 requires matplotlib>=3.6.0, but you have matplotlib 3.5.2 which is incompatible.\n","plotnine 0.12.2 requires pandas>=1.5.0, but you have pandas 1.4.3 which is incompatible.\n","tensorflow 2.12.0 requires protobuf!=4.21.0,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,<5.0.0dev,>=3.20.3, but you have protobuf 3.20.1 which is incompatible.\n","tensorflow-metadata 1.14.0 requires protobuf<4.21,>=3.20.3, but you have protobuf 3.20.1 which is incompatible.\u001b[0m\u001b[31m\n","\u001b[0mSuccessfully installed huggingface-hub-0.16.4 lightning-utilities-0.9.0 matplotlib-3.5.2 pandas-1.4.3 protobuf-3.20.1 pyDeprecate-0.3.2 pycocotools-2.0.2 pytorch_lightning-1.6.5 scipy-1.8.1 timm-0.6.5 tokenizers-0.12.1 torchaudio-0.12.0 torchmetrics-1.1.0 torchvision-0.13.0 tqdm-4.64.0 transformers-4.20.1\n"]},{"output_type":"display_data","data":{"application/vnd.colab-display-data+json":{"pip_warning":{"packages":["google","matplotlib","mpl_toolkits"]}}},"metadata":{}},{"output_type":"stream","name":"stdout","text":["Requirement already satisfied: torchtext==0.13.0 in /usr/local/lib/python3.10/dist-packages (0.13.0)\n","Requirement already satisfied: tqdm in /usr/local/lib/python3.10/dist-packages (from torchtext==0.13.0) (4.64.0)\n","Requirement already satisfied: requests in /usr/local/lib/python3.10/dist-packages (from torchtext==0.13.0) (2.31.0)\n","Requirement already satisfied: torch==1.12.0 in /usr/local/lib/python3.10/dist-packages (from torchtext==0.13.0) (1.12.0)\n","Requirement already satisfied: numpy in /usr/local/lib/python3.10/dist-packages (from torchtext==0.13.0) (1.23.5)\n","Requirement already satisfied: typing-extensions in /usr/local/lib/python3.10/dist-packages (from torch==1.12.0->torchtext==0.13.0) (4.7.1)\n","Requirement already satisfied: charset-normalizer<4,>=2 in /usr/local/lib/python3.10/dist-packages (from requests->torchtext==0.13.0) (3.2.0)\n","Requirement already satisfied: idna<4,>=2.5 in /usr/local/lib/python3.10/dist-packages (from requests->torchtext==0.13.0) (3.4)\n","Requirement already satisfied: urllib3<3,>=1.21.1 in /usr/local/lib/python3.10/dist-packages (from requests->torchtext==0.13.0) (2.0.4)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.10/dist-packages (from requests->torchtext==0.13.0) (2023.7.22)\n"]}],"source":["!pip install -r /content/Transform_detector/requirements.txt\n","!pip install torchtext==0.13.0"]},{"cell_type":"code","source":["#import pandas as pd\n","#df = pd.read_csv('/content/drive/MyDrive/Стажировка/Рентген/transformer_labels.csv')\n","#df = df[4000:]\n","#df.to_csv('/content/drive/MyDrive/Стажировка/Рентген/transformer_labels_new.csv', index=False)"],"metadata":{"id":"JIq7Swal_enW"},"execution_count":null,"outputs":[]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":9851,"status":"ok","timestamp":1693062852251,"user":{"displayName":"Vafelka","userId":"11276804272897708630"},"user_tz":-180},"id":"SNrUhktmhtdJ","outputId":"b2b6014e-3356-4b0d-abc0-80b77eaa95ec"},"outputs":[{"output_type":"stream","name":"stdout","text":["...TRAIN...\n","Starting...\n","1/3 The categories have been completed.\n","2/3 The images have been completed.\n","3/3 Annotations have been completed.\n","Done.\n"]}],"source":["!python /content/Transform_detector/src/data_preparation.py -c /content/drive/MyDrive/Стажировка/Рентген/transformer_labels.csv -i True"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":2191,"status":"ok","timestamp":1693062538317,"user":{"displayName":"Vafelka","userId":"11276804272897708630"},"user_tz":-180},"id":"csXDnKhL51bT","outputId":"45621cc2-fee8-495a-b41d-c72cf26066b0"},"outputs":[{"output_type":"stream","name":"stdout","text":["...TEST...\n","Starting...\n","1/3 The categories have been completed.\n","2/3 The images have been completed.\n","3/3 Annotations have been completed.\n","Done.\n"]}],"source":["!python /content/Transform_detector/src/data_preparation.py -c /content/drive/MyDrive/Стажировка/Рентген/transformer_test_labels.csv -i False"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"hQudln2ViKWP","executionInfo":{"status":"ok","timestamp":1693067214572,"user_tz":-180,"elapsed":4357184,"user":{"displayName":"Vafelka","userId":"11276804272897708630"}},"outputId":"7895ddec-8f9b-467b-f5a7-e43f9bb86c2d"},"outputs":[{"output_type":"stream","name":"stdout","text":["loading annotations into memory...\n","Done (t=0.02s)\n","creating index...\n","index created!\n","loading annotations into memory...\n","Done (t=0.00s)\n","creating index...\n","index created!\n","Some weights of DetrForObjectDetection were not initialized from the model checkpoint at facebook/detr-resnet-50 and are newly initialized because the shapes did not match:\n","- class_labels_classifier.weight: found shape torch.Size([92, 256]) in the checkpoint and torch.Size([2, 256]) in the model instantiated\n","- class_labels_classifier.bias: found shape torch.Size([92]) in the checkpoint and torch.Size([2]) in the model instantiated\n","You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.\n","GPU available: True, used: True\n","TPU available: False, using: 0 TPU cores\n","IPU available: False, using: 0 IPUs\n","HPU available: False, using: 0 HPUs\n","Missing logger folder: /content/lightning_logs\n","LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]\n","\n","  | Name  | Type                   | Params\n","-------------------------------------------------\n","0 | model | DetrForObjectDetection | 41.5 M\n","-------------------------------------------------\n","41.3 M    Trainable params\n","222 K     Non-trainable params\n","41.5 M    Total params\n","166.037   Total estimated model params size (MB)\n","Sanity Checking DataLoader 0:   0% 0/2 [00:00<?, ?it/s]/usr/local/lib/python3.10/dist-packages/pytorch_lightning/utilities/data.py:72: UserWarning: Trying to infer the `batch_size` from an ambiguous collection. The batch size we found is 2. To avoid any miscalculations, use `self.log(..., batch_size=batch_size)`.\n","  warning_cache.warn(\n","Epoch 0:  10% 40/420 [00:49<07:48,  1.23s/it, loss=2.99, v_num=0]2023-08-26 15:15:26.907659: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.\n","To enable the following instructions: AVX2 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.\n","2023-08-26 15:15:28.726431: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT\n","Epoch 0:  67% 280/420 [06:04<03:02,  1.30s/it, loss=2.77, v_num=0]\n","Validation: 0it [00:00, ?it/s]\u001b[A\n","Validation:   0% 0/124 [00:00<?, ?it/s]\u001b[A\n","Epoch 0:  71% 300/420 [06:27<02:35,  1.29s/it, loss=2.77, v_num=0]\n","Validation DataLoader 0:  16% 20/124 [00:10<00:55,  1.87it/s]\u001b[A\n","Epoch 0:  76% 320/420 [06:38<02:04,  1.25s/it, loss=2.77, v_num=0]\n","Validation DataLoader 0:  32% 40/124 [00:20<00:43,  1.92it/s]\u001b[A\n","Epoch 0:  81% 340/420 [06:49<01:36,  1.20s/it, loss=2.77, v_num=0]\n","Validation DataLoader 0:  48% 60/124 [00:31<00:33,  1.89it/s]\u001b[A\n","Epoch 0:  86% 360/420 [06:59<01:09,  1.17s/it, loss=2.77, v_num=0]\n","Validation DataLoader 0:  65% 80/124 [00:41<00:22,  1.94it/s]\u001b[A\n","Epoch 0:  90% 380/420 [07:10<00:45,  1.13s/it, loss=2.77, v_num=0]\n","Validation DataLoader 0:  81% 100/124 [00:53<00:12,  1.87it/s]\u001b[A\n","Epoch 0:  95% 400/420 [07:20<00:22,  1.10s/it, loss=2.77, v_num=0]\n","Validation DataLoader 0:  97% 120/124 [01:03<00:02,  1.88it/s]\u001b[A\n","Validation DataLoader 0:  97% 120/124 [01:03<00:02,  1.88it/s]\u001b[A/usr/local/lib/python3.10/dist-packages/pytorch_lightning/utilities/data.py:72: UserWarning: Trying to infer the `batch_size` from an ambiguous collection. The batch size we found is 1. To avoid any miscalculations, use `self.log(..., batch_size=batch_size)`.\n","  warning_cache.warn(\n","\n","Validation DataLoader 0: 100% 124/124 [01:05<00:00,  1.88it/s]\u001b[A\n","Epoch 0: 100% 420/420 [07:31<00:00,  1.08s/it, loss=2.85, v_num=0]\n","Epoch 1:  67% 280/420 [06:01<03:00,  1.29s/it, loss=2.76, v_num=0]\n","Validation: 0it [00:00, ?it/s]\u001b[A\n","Validation:   0% 0/124 [00:00<?, ?it/s]\u001b[A\n","Epoch 1:  71% 300/420 [06:24<02:33,  1.28s/it, loss=2.76, v_num=0]\n","Validation DataLoader 0:  16% 20/124 [00:10<00:53,  1.95it/s]\u001b[A\n","Epoch 1:  76% 320/420 [06:35<02:03,  1.23s/it, loss=2.76, v_num=0]\n","Validation DataLoader 0:  32% 40/124 [00:20<00:42,  1.98it/s]\u001b[A\n","Epoch 1:  81% 340/420 [06:44<01:35,  1.19s/it, loss=2.76, v_num=0]\n","Validation DataLoader 0:  48% 60/124 [00:31<00:33,  1.90it/s]\u001b[A\n","Epoch 1:  86% 360/420 [06:55<01:09,  1.15s/it, loss=2.76, v_num=0]\n","Validation DataLoader 0:  65% 80/124 [00:40<00:22,  1.97it/s]\u001b[A\n","Epoch 1:  90% 380/420 [07:05<00:44,  1.12s/it, loss=2.76, v_num=0]\n","Validation DataLoader 0:  81% 100/124 [00:52<00:12,  1.88it/s]\u001b[A\n","Epoch 1:  95% 400/420 [07:16<00:21,  1.09s/it, loss=2.76, v_num=0]\n","Validation DataLoader 0:  97% 120/124 [01:02<00:02,  1.94it/s]\u001b[A\n","Validation DataLoader 0:  97% 120/124 [01:02<00:02,  1.94it/s]\u001b[A\n","Validation DataLoader 0: 100% 124/124 [01:04<00:00,  1.93it/s]\u001b[A\n","Epoch 1: 100% 420/420 [07:26<00:00,  1.06s/it, loss=2.76, v_num=0]\n","Epoch 2:  67% 280/420 [06:04<03:02,  1.30s/it, loss=2.71, v_num=0]\n","Validation: 0it [00:00, ?it/s]\u001b[A\n","Validation:   0% 0/124 [00:00<?, ?it/s]\u001b[A\n","Epoch 2:  71% 300/420 [06:29<02:35,  1.30s/it, loss=2.71, v_num=0]\n","Validation DataLoader 0:  16% 20/124 [00:10<00:53,  1.96it/s]\u001b[A\n","Epoch 2:  76% 320/420 [06:40<02:05,  1.25s/it, loss=2.71, v_num=0]\n","Validation DataLoader 0:  32% 40/124 [00:21<00:44,  1.88it/s]\u001b[A\n","Epoch 2:  81% 340/420 [06:50<01:36,  1.21s/it, loss=2.71, v_num=0]\n","Validation DataLoader 0:  48% 60/124 [00:31<00:34,  1.87it/s]\u001b[A\n","Epoch 2:  86% 360/420 [07:01<01:10,  1.17s/it, loss=2.71, v_num=0]\n","Validation DataLoader 0:  65% 80/124 [00:41<00:22,  1.94it/s]\u001b[A\n","Epoch 2:  90% 380/420 [07:10<00:45,  1.13s/it, loss=2.71, v_num=0]\n","Validation DataLoader 0:  81% 100/124 [00:52<00:12,  1.88it/s]\u001b[A\n","Epoch 2:  95% 400/420 [07:22<00:22,  1.11s/it, loss=2.71, v_num=0]\n","Validation DataLoader 0:  97% 120/124 [01:02<00:02,  1.97it/s]\u001b[A\n","Validation DataLoader 0:  97% 120/124 [01:02<00:02,  1.97it/s]\u001b[A\n","Validation DataLoader 0: 100% 124/124 [01:04<00:00,  1.96it/s]\u001b[A\n","Epoch 2: 100% 420/420 [07:31<00:00,  1.08s/it, loss=2.69, v_num=0]\n","Epoch 3:  67% 280/420 [06:02<03:01,  1.29s/it, loss=2.76, v_num=0]\n","Validation: 0it [00:00, ?it/s]\u001b[A\n","Validation:   0% 0/124 [00:00<?, ?it/s]\u001b[A\n","Epoch 3:  71% 300/420 [06:24<02:33,  1.28s/it, loss=2.76, v_num=0]\n","Validation DataLoader 0:  16% 20/124 [00:10<00:53,  1.93it/s]\u001b[A\n","Epoch 3:  76% 320/420 [06:34<02:03,  1.23s/it, loss=2.76, v_num=0]\n","Validation DataLoader 0:  32% 40/124 [00:20<00:41,  2.00it/s]\u001b[A\n","Epoch 3:  81% 340/420 [06:44<01:35,  1.19s/it, loss=2.76, v_num=0]\n","Validation DataLoader 0:  48% 60/124 [00:30<00:33,  1.93it/s]\u001b[A\n","Epoch 3:  86% 360/420 [06:55<01:09,  1.15s/it, loss=2.76, v_num=0]\n","Validation DataLoader 0:  65% 80/124 [00:40<00:22,  1.98it/s]\u001b[A\n","Epoch 3:  90% 380/420 [07:05<00:44,  1.12s/it, loss=2.76, v_num=0]\n","Validation DataLoader 0:  81% 100/124 [00:51<00:12,  1.90it/s]\u001b[A\n","Epoch 3:  95% 400/420 [07:16<00:21,  1.09s/it, loss=2.76, v_num=0]\n","Validation DataLoader 0:  97% 120/124 [01:01<00:02,  1.96it/s]\u001b[A\n","Validation DataLoader 0:  97% 120/124 [01:01<00:02,  1.96it/s]\u001b[A\n","Validation DataLoader 0: 100% 124/124 [01:03<00:00,  1.95it/s]\u001b[A\n","Epoch 3: 100% 420/420 [07:25<00:00,  1.06s/it, loss=2.76, v_num=0]\n","Epoch 4:  67% 280/420 [06:03<03:01,  1.30s/it, loss=2.73, v_num=0]\n","Validation: 0it [00:00, ?it/s]\u001b[A\n","Validation:   0% 0/124 [00:00<?, ?it/s]\u001b[A\n","Epoch 4:  71% 300/420 [06:25<02:34,  1.29s/it, loss=2.73, v_num=0]\n","Validation DataLoader 0:  16% 20/124 [00:09<00:51,  2.03it/s]\u001b[A\n","Epoch 4:  76% 320/420 [06:36<02:03,  1.24s/it, loss=2.73, v_num=0]\n","Validation DataLoader 0:  32% 40/124 [00:20<00:43,  1.93it/s]\u001b[A\n","Epoch 4:  81% 340/420 [06:46<01:35,  1.20s/it, loss=2.73, v_num=0]\n","Validation DataLoader 0:  48% 60/124 [00:30<00:33,  1.93it/s]\u001b[A\n","Epoch 4:  86% 360/420 [06:57<01:09,  1.16s/it, loss=2.73, v_num=0]\n","Validation DataLoader 0:  65% 80/124 [00:40<00:22,  1.97it/s]\u001b[A\n","Epoch 4:  90% 380/420 [07:06<00:44,  1.12s/it, loss=2.73, v_num=0]\n","Validation DataLoader 0:  81% 100/124 [00:52<00:12,  1.88it/s]\u001b[A\n","Epoch 4:  95% 400/420 [07:18<00:21,  1.10s/it, loss=2.73, v_num=0]\n","Validation DataLoader 0:  97% 120/124 [01:01<00:02,  1.97it/s]\u001b[A\n","Validation DataLoader 0:  97% 120/124 [01:01<00:02,  1.97it/s]\u001b[A\n","Validation DataLoader 0: 100% 124/124 [01:03<00:00,  1.99it/s]\u001b[A\n","Epoch 4: 100% 420/420 [07:27<00:00,  1.07s/it, loss=2.74, v_num=0]\n","Epoch 5:  67% 280/420 [06:01<03:00,  1.29s/it, loss=2.68, v_num=0]\n","Validation: 0it [00:00, ?it/s]\u001b[A\n","Validation:   0% 0/124 [00:00<?, ?it/s]\u001b[A\n","Epoch 5:  71% 300/420 [06:24<02:33,  1.28s/it, loss=2.68, v_num=0]\n","Validation DataLoader 0:  16% 20/124 [00:10<00:54,  1.90it/s]\u001b[A\n","Epoch 5:  76% 320/420 [06:35<02:03,  1.23s/it, loss=2.68, v_num=0]\n","Validation DataLoader 0:  32% 40/124 [00:20<00:42,  1.98it/s]\u001b[A\n","Epoch 5:  81% 340/420 [06:44<01:35,  1.19s/it, loss=2.68, v_num=0]\n","Validation DataLoader 0:  48% 60/124 [00:31<00:33,  1.91it/s]\u001b[A\n","Epoch 5:  86% 360/420 [06:55<01:09,  1.15s/it, loss=2.68, v_num=0]\n","Validation DataLoader 0:  65% 80/124 [00:41<00:22,  1.96it/s]\u001b[A\n","Epoch 5:  90% 380/420 [07:05<00:44,  1.12s/it, loss=2.68, v_num=0]\n","Validation DataLoader 0:  81% 100/124 [00:52<00:12,  1.88it/s]\u001b[A\n","Epoch 5:  95% 400/420 [07:16<00:21,  1.09s/it, loss=2.68, v_num=0]\n","Validation DataLoader 0:  97% 120/124 [01:04<00:02,  1.81it/s]\u001b[A\n","Validation DataLoader 0:  97% 120/124 [01:04<00:02,  1.81it/s]\u001b[A\n","Validation DataLoader 0: 100% 124/124 [01:06<00:00,  1.80it/s]\u001b[A\n","Epoch 5: 100% 420/420 [07:28<00:00,  1.07s/it, loss=2.71, v_num=0]\n","Epoch 6:  67% 280/420 [06:01<03:00,  1.29s/it, loss=2.7, v_num=0] \n","Validation: 0it [00:00, ?it/s]\u001b[A\n","Validation:   0% 0/124 [00:00<?, ?it/s]\u001b[A\n","Epoch 6:  71% 300/420 [06:22<02:33,  1.28s/it, loss=2.7, v_num=0]\n","Validation DataLoader 0:  16% 20/124 [00:09<00:48,  2.14it/s]\u001b[A\n","Epoch 6:  76% 320/420 [06:33<02:02,  1.23s/it, loss=2.7, v_num=0]\n","Validation DataLoader 0:  32% 40/124 [00:20<00:44,  1.90it/s]\u001b[A\n","Epoch 6:  81% 340/420 [06:43<01:34,  1.19s/it, loss=2.7, v_num=0]\n","Validation DataLoader 0:  48% 60/124 [00:30<00:32,  1.95it/s]\u001b[A\n","Epoch 6:  86% 360/420 [06:54<01:09,  1.15s/it, loss=2.7, v_num=0]\n","Validation DataLoader 0:  65% 80/124 [00:41<00:22,  1.93it/s]\u001b[A\n","Epoch 6:  90% 380/420 [07:04<00:44,  1.12s/it, loss=2.7, v_num=0]\n","Validation DataLoader 0:  81% 100/124 [00:51<00:12,  1.94it/s]\u001b[A\n","Epoch 6:  95% 400/420 [07:14<00:21,  1.09s/it, loss=2.7, v_num=0]\n","Validation DataLoader 0:  97% 120/124 [01:01<00:02,  1.96it/s]\u001b[A\n","Validation DataLoader 0:  97% 120/124 [01:01<00:02,  1.96it/s]\u001b[A\n","Validation DataLoader 0: 100% 124/124 [01:03<00:00,  1.99it/s]\u001b[A\n","Epoch 6: 100% 420/420 [07:24<00:00,  1.06s/it, loss=2.69, v_num=0]\n","Epoch 7:  67% 280/420 [06:00<03:00,  1.29s/it, loss=2.73, v_num=0]\n","Validation: 0it [00:00, ?it/s]\u001b[A\n","Validation:   0% 0/124 [00:00<?, ?it/s]\u001b[A\n","Epoch 7:  71% 300/420 [06:24<02:33,  1.28s/it, loss=2.73, v_num=0]\n","Validation DataLoader 0:  16% 20/124 [00:10<00:52,  1.99it/s]\u001b[A\n","Epoch 7:  76% 320/420 [06:34<02:03,  1.23s/it, loss=2.73, v_num=0]\n","Validation DataLoader 0:  32% 40/124 [00:20<00:43,  1.95it/s]\u001b[A\n","Epoch 7:  81% 340/420 [06:45<01:35,  1.19s/it, loss=2.73, v_num=0]\n","Validation DataLoader 0:  48% 60/124 [00:30<00:32,  1.97it/s]\u001b[A\n","Epoch 7:  86% 360/420 [06:55<01:09,  1.15s/it, loss=2.73, v_num=0]\n","Validation DataLoader 0:  65% 80/124 [00:41<00:22,  1.91it/s]\u001b[A\n","Epoch 7:  90% 380/420 [07:06<00:44,  1.12s/it, loss=2.73, v_num=0]\n","Validation DataLoader 0:  81% 100/124 [00:51<00:12,  1.93it/s]\u001b[A\n","Epoch 7:  95% 400/420 [07:16<00:21,  1.09s/it, loss=2.73, v_num=0]\n","Validation DataLoader 0:  97% 120/124 [01:02<00:02,  1.90it/s]\u001b[A\n","Epoch 7:  95% 400/420 [07:26<00:22,  1.12s/it, loss=2.73, v_num=0]\n","Validation DataLoader 0: 100% 124/124 [01:04<00:00,  1.92it/s]\u001b[A\n","Epoch 7: 100% 420/420 [07:27<00:00,  1.06s/it, loss=2.67, v_num=0]\n","Epoch 8:  67% 280/420 [06:02<03:01,  1.29s/it, loss=2.69, v_num=0]\n","Validation: 0it [00:00, ?it/s]\u001b[A\n","Validation:   0% 0/124 [00:00<?, ?it/s]\u001b[A\n","Epoch 8:  71% 300/420 [06:25<02:34,  1.28s/it, loss=2.69, v_num=0]\n","Validation DataLoader 0:  16% 20/124 [00:09<00:48,  2.15it/s]\u001b[A\n","Epoch 8:  76% 320/420 [06:34<02:03,  1.23s/it, loss=2.69, v_num=0]\n","Validation DataLoader 0:  32% 40/124 [00:20<00:44,  1.87it/s]\u001b[A\n","Epoch 8:  81% 340/420 [06:46<01:35,  1.19s/it, loss=2.69, v_num=0]\n","Validation DataLoader 0:  48% 60/124 [00:30<00:32,  1.99it/s]\u001b[A\n","Epoch 8:  86% 360/420 [06:55<01:09,  1.16s/it, loss=2.69, v_num=0]\n","Validation DataLoader 0:  65% 80/124 [00:43<00:24,  1.79it/s]\u001b[A\n","Epoch 8:  90% 380/420 [07:09<00:45,  1.13s/it, loss=2.69, v_num=0]\n","Validation DataLoader 0:  81% 100/124 [00:54<00:13,  1.75it/s]\u001b[A\n","Epoch 8:  95% 400/420 [07:20<00:22,  1.10s/it, loss=2.69, v_num=0]\n","Validation DataLoader 0:  97% 120/124 [01:05<00:02,  1.78it/s]\u001b[A\n","Validation DataLoader 0:  97% 120/124 [01:05<00:02,  1.78it/s]\u001b[A\n","Validation DataLoader 0: 100% 124/124 [01:07<00:00,  1.81it/s]\u001b[A\n","Epoch 8: 100% 420/420 [07:31<00:00,  1.07s/it, loss=2.65, v_num=0]\n","Epoch 9:  38% 160/420 [03:25<05:33,  1.28s/it, loss=2.69, v_num=0]/usr/local/lib/python3.10/dist-packages/pytorch_lightning/trainer/trainer.py:726: UserWarning: Detected KeyboardInterrupt, attempting graceful shutdown...\n","  rank_zero_warn(\"Detected KeyboardInterrupt, attempting graceful shutdown...\")\n","Running evaluation...\n","\n","  0% 0/124 [00:00<?, ?it/s]\u001b[A\n","  1% 1/124 [00:00<01:25,  1.45it/s]\u001b[A\n","  2% 2/124 [00:01<01:20,  1.51it/s]\u001b[A\n","  2% 3/124 [00:01<01:18,  1.55it/s]\u001b[A\n","  3% 4/124 [00:02<01:15,  1.60it/s]\u001b[A\n","  4% 5/124 [00:03<01:13,  1.62it/s]\u001b[A\n","  5% 6/124 [00:03<01:10,  1.67it/s]\u001b[A\n","  6% 7/124 [00:04<01:10,  1.65it/s]\u001b[A\n","  6% 8/124 [00:04<01:08,  1.68it/s]\u001b[A\n","  7% 9/124 [00:05<01:03,  1.80it/s]\u001b[A\n","  8% 10/124 [00:05<01:01,  1.86it/s]\u001b[A\n","  9% 11/124 [00:06<00:59,  1.89it/s]\u001b[A\n"," 10% 12/124 [00:06<00:58,  1.91it/s]\u001b[A\n"," 10% 13/124 [00:07<00:56,  1.95it/s]\u001b[A\n"," 11% 14/124 [00:07<00:56,  1.95it/s]\u001b[A\n"," 12% 15/124 [00:08<00:54,  1.99it/s]\u001b[A\n"," 13% 16/124 [00:08<00:55,  1.94it/s]\u001b[A\n"," 14% 17/124 [00:09<00:53,  2.00it/s]\u001b[A\n"," 15% 18/124 [00:09<00:53,  2.00it/s]\u001b[A\n"," 15% 19/124 [00:10<00:51,  2.04it/s]\u001b[A\n"," 16% 20/124 [00:10<00:50,  2.06it/s]\u001b[A\n"," 17% 21/124 [00:11<00:50,  2.02it/s]\u001b[A\n"," 18% 22/124 [00:11<00:50,  2.04it/s]\u001b[A\n"," 19% 23/124 [00:12<00:48,  2.08it/s]\u001b[A\n"," 19% 24/124 [00:12<00:48,  2.05it/s]\u001b[A\n"," 20% 25/124 [00:13<00:51,  1.90it/s]\u001b[A\n"," 21% 26/124 [00:14<00:54,  1.81it/s]\u001b[A\n"," 22% 27/124 [00:14<00:54,  1.77it/s]\u001b[A\n"," 23% 28/124 [00:15<00:57,  1.68it/s]\u001b[A\n"," 23% 29/124 [00:15<00:59,  1.60it/s]\u001b[A\n"," 24% 30/124 [00:16<00:59,  1.57it/s]\u001b[A\n"," 25% 31/124 [00:17<01:01,  1.50it/s]\u001b[A\n"," 26% 32/124 [00:18<01:01,  1.48it/s]\u001b[A\n"," 27% 33/124 [00:18<01:02,  1.45it/s]\u001b[A\n"," 27% 34/124 [00:19<01:02,  1.44it/s]\u001b[A\n"," 28% 35/124 [00:20<01:04,  1.39it/s]\u001b[A\n"," 29% 36/124 [00:20<01:01,  1.43it/s]\u001b[A\n"," 30% 37/124 [00:21<01:01,  1.42it/s]\u001b[A\n"," 31% 38/124 [00:22<01:04,  1.33it/s]\u001b[A\n"," 31% 39/124 [00:23<01:01,  1.38it/s]\u001b[A\n"," 32% 40/124 [00:24<01:05,  1.29it/s]\u001b[A\n"," 33% 41/124 [00:24<01:01,  1.34it/s]\u001b[A\n"," 34% 42/124 [00:25<00:58,  1.40it/s]\u001b[A\n"," 35% 43/124 [00:26<00:59,  1.37it/s]\u001b[A\n"," 35% 44/124 [00:26<00:57,  1.39it/s]\u001b[A\n"," 36% 45/124 [00:27<00:56,  1.40it/s]\u001b[A\n"," 37% 46/124 [00:28<00:54,  1.43it/s]\u001b[A\n"," 38% 47/124 [00:28<00:53,  1.43it/s]\u001b[A\n"," 39% 48/124 [00:29<00:50,  1.49it/s]\u001b[A\n"," 40% 49/124 [00:30<00:46,  1.61it/s]\u001b[A\n"," 40% 50/124 [00:30<00:42,  1.76it/s]\u001b[A\n"," 41% 51/124 [00:30<00:40,  1.81it/s]\u001b[A\n"," 42% 52/124 [00:31<00:37,  1.90it/s]\u001b[A\n"," 43% 53/124 [00:31<00:36,  1.94it/s]\u001b[A\n"," 44% 54/124 [00:32<00:35,  1.99it/s]\u001b[A\n"," 44% 55/124 [00:32<00:35,  1.96it/s]\u001b[A\n"," 45% 56/124 [00:33<00:34,  1.98it/s]\u001b[A\n"," 46% 57/124 [00:33<00:35,  1.89it/s]\u001b[A\n"," 47% 58/124 [00:34<00:34,  1.93it/s]\u001b[A\n"," 48% 59/124 [00:35<00:33,  1.92it/s]\u001b[A\n"," 48% 60/124 [00:35<00:32,  1.98it/s]\u001b[A\n"," 49% 61/124 [00:35<00:31,  2.02it/s]\u001b[A\n"," 50% 62/124 [00:36<00:30,  2.05it/s]\u001b[A\n"," 51% 63/124 [00:36<00:29,  2.06it/s]\u001b[A\n"," 52% 64/124 [00:37<00:29,  2.01it/s]\u001b[A\n"," 52% 65/124 [00:37<00:28,  2.05it/s]\u001b[A\n"," 53% 66/124 [00:38<00:27,  2.07it/s]\u001b[A\n"," 54% 67/124 [00:38<00:27,  2.10it/s]\u001b[A\n"," 55% 68/124 [00:39<00:27,  2.06it/s]\u001b[A\n"," 56% 69/124 [00:39<00:28,  1.95it/s]\u001b[A\n"," 56% 70/124 [00:40<00:29,  1.81it/s]\u001b[A\n"," 57% 71/124 [00:41<00:30,  1.73it/s]\u001b[A\n"," 58% 72/124 [00:41<00:31,  1.63it/s]\u001b[A\n"," 59% 73/124 [00:42<00:31,  1.60it/s]\u001b[A\n"," 60% 74/124 [00:43<00:31,  1.57it/s]\u001b[A\n"," 60% 75/124 [00:43<00:31,  1.56it/s]\u001b[A\n"," 61% 76/124 [00:44<00:30,  1.57it/s]\u001b[A\n"," 62% 77/124 [00:45<00:30,  1.56it/s]\u001b[A\n"," 63% 78/124 [00:45<00:29,  1.57it/s]\u001b[A\n"," 64% 79/124 [00:46<00:29,  1.54it/s]\u001b[A\n"," 65% 80/124 [00:47<00:27,  1.60it/s]\u001b[A\n"," 65% 81/124 [00:47<00:26,  1.63it/s]\u001b[A\n"," 66% 82/124 [00:48<00:26,  1.60it/s]\u001b[A\n"," 67% 83/124 [00:48<00:24,  1.65it/s]\u001b[A\n"," 68% 84/124 [00:49<00:22,  1.76it/s]\u001b[A\n"," 69% 85/124 [00:49<00:21,  1.81it/s]\u001b[A\n"," 69% 86/124 [00:50<00:20,  1.86it/s]\u001b[A\n"," 70% 87/124 [00:50<00:19,  1.87it/s]\u001b[A\n"," 71% 88/124 [00:51<00:18,  1.91it/s]\u001b[A\n"," 72% 89/124 [00:51<00:17,  1.96it/s]\u001b[A\n"," 73% 90/124 [00:52<00:16,  2.01it/s]\u001b[A\n"," 73% 91/124 [00:52<00:16,  1.99it/s]\u001b[A\n"," 74% 92/124 [00:53<00:16,  1.97it/s]\u001b[A\n"," 75% 93/124 [00:53<00:15,  1.99it/s]\u001b[A\n"," 76% 94/124 [00:54<00:15,  1.99it/s]\u001b[A\n"," 77% 95/124 [00:54<00:14,  2.02it/s]\u001b[A\n"," 77% 96/124 [00:55<00:14,  1.98it/s]\u001b[A\n"," 78% 97/124 [00:55<00:13,  1.99it/s]\u001b[A\n"," 79% 98/124 [00:56<00:12,  2.04it/s]\u001b[A\n"," 80% 99/124 [00:56<00:12,  1.98it/s]\u001b[A\n"," 81% 100/124 [00:57<00:11,  2.00it/s]\u001b[A\n"," 81% 101/124 [00:57<00:11,  1.99it/s]\u001b[A\n"," 82% 102/124 [00:58<00:10,  2.04it/s]\u001b[A\n"," 83% 103/124 [00:58<00:10,  2.03it/s]\u001b[A\n"," 84% 104/124 [00:59<00:10,  1.86it/s]\u001b[A\n"," 85% 105/124 [01:00<00:10,  1.79it/s]\u001b[A\n"," 85% 106/124 [01:00<00:10,  1.67it/s]\u001b[A\n"," 86% 107/124 [01:01<00:10,  1.68it/s]\u001b[A\n"," 87% 108/124 [01:01<00:09,  1.64it/s]\u001b[A\n"," 88% 109/124 [01:02<00:09,  1.60it/s]\u001b[A\n"," 89% 110/124 [01:03<00:08,  1.63it/s]\u001b[A\n"," 90% 111/124 [01:03<00:07,  1.64it/s]\u001b[A\n"," 90% 112/124 [01:04<00:07,  1.65it/s]\u001b[A\n"," 91% 113/124 [01:05<00:06,  1.63it/s]\u001b[A\n"," 92% 114/124 [01:05<00:06,  1.62it/s]\u001b[A\n"," 93% 115/124 [01:06<00:05,  1.64it/s]\u001b[A\n"," 94% 116/124 [01:06<00:04,  1.64it/s]\u001b[A\n"," 94% 117/124 [01:07<00:04,  1.68it/s]\u001b[A\n"," 95% 118/124 [01:08<00:03,  1.66it/s]\u001b[A\n"," 96% 119/124 [01:08<00:02,  1.70it/s]\u001b[A\n"," 97% 120/124 [01:09<00:02,  1.79it/s]\u001b[A\n"," 98% 121/124 [01:09<00:01,  1.86it/s]\u001b[A\n"," 98% 122/124 [01:10<00:01,  1.89it/s]\u001b[A\n"," 99% 123/124 [01:10<00:00,  1.96it/s]\u001b[A\n","100% 124/124 [01:10<00:00,  1.75it/s]\n","Accumulating evaluation results...\n","DONE (t=0.23s).\n","IoU metric: bbox\n"," Average Precision  (AP) @[ IoU=0.50:0.95 | area=   all | maxDets=100 ] = 0.000\n"," Average Precision  (AP) @[ IoU=0.50      | area=   all | maxDets=100 ] = 0.002\n"," Average Precision  (AP) @[ IoU=0.75      | area=   all | maxDets=100 ] = 0.000\n"," Average Precision  (AP) @[ IoU=0.50:0.95 | area= small | maxDets=100 ] = 0.000\n"," Average Precision  (AP) @[ IoU=0.50:0.95 | area=medium | maxDets=100 ] = 0.000\n"," Average Precision  (AP) @[ IoU=0.50:0.95 | area= large | maxDets=100 ] = 0.000\n"," Average Recall     (AR) @[ IoU=0.50:0.95 | area=   all | maxDets=  1 ] = 0.000\n"," Average Recall     (AR) @[ IoU=0.50:0.95 | area=   all | maxDets= 10 ] = 0.005\n"," Average Recall     (AR) @[ IoU=0.50:0.95 | area=   all | maxDets=100 ] = 0.038\n"," Average Recall     (AR) @[ IoU=0.50:0.95 | area= small | maxDets=100 ] = 0.000\n"," Average Recall     (AR) @[ IoU=0.50:0.95 | area=medium | maxDets=100 ] = 0.032\n"," Average Recall     (AR) @[ IoU=0.50:0.95 | area= large | maxDets=100 ] = 0.058\n"]}],"source":["!python /content/Transform_detector/src/train.py -n /content/ph_final/train/images -t /content/ph_final/valid/images"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":15,"status":"ok","timestamp":1693058000709,"user":{"displayName":"Vafelka","userId":"11276804272897708630"},"user_tz":-180},"id":"24WKrCOjAaNy","outputId":"63e6d940-f1a0-4b8d-8037-2b93633618bd"},"outputs":[{"output_type":"stream","name":"stdout","text":["GPU 0: Tesla T4 (UUID: GPU-dd5ac458-9640-7a22-f7bb-a7825c5cdeb1)\n"]}],"source":["!nvidia-smi -L"]}],"metadata":{"colab":{"provenance":[{"file_id":"1_dvbpyamBF6838eOe9ydkEjhDjuXIUrP","timestamp":1693505345120},{"file_id":"1tu4-MKCV7CJdI6hW-CUwWJMaDysG_XPi","timestamp":1632159390949}],"gpuType":"T4"},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"},"accelerator":"GPU"},"nbformat":4,"nbformat_minor":0}